# Gophermart - Накопительная система лояльности «Гофермарт»
## Запуск проект локально

### Клонировать проект
```bash
mkdir myproject && cd myproject
git clone https://github.com/playmixer/gophermart.git .
```
### Запустить контейнеры
```bash
cd deploy
docker-compose up
```
После запуска для тестирования перейти на
http://localhost:8080/swagger/index.html



# Генерация swagger документации
выполнить из корня проекта команду:
```sh
swag init -o ./docs -g ./internal/adapters/api/rest/rest.go
```
подробнее в https://github.com/swaggo/swag

# Сценарий тестирования
### Регистрация ```POST /api/user/register```
| название    | тело запроса (json) | ответ (статус) | описание |
|-------------|---------------------|----------------|----------|
| correct     | ```{"username":"user", "passwrod": "pass"}``` | 200 | пользователь создан/авторизован |
| empty       | ```{"username":"", "passwrod": ""}``` | 400 | переданы не корректный логин или пароль |
| not unique | ```{"username":"user", "passwrod": "pass"}``` | 409 | дубликат пользователя |

### Авторизация ```POST /api/user/login```
| название    | тело запроса (json) | ответ (статус) | описание |
|-------------|---------------------|----------------|----------|
| correct     | ```{"username":"user", "passwrod": "pass"}``` | 200 | пользователь авторизован |
| empty       | ```{"username":"", "passwrod": ""}``` | 400 | неверный формат запроса |
| unauthorize | ```{"username":"user", "passwrod": "pass"}``` | 401 | неверная пара логин/пароль |

### Загрузить заказ ```POST /api/user/orders```
| название    | тело запроса (text) | ответ (статус) | описание |
|-------------|---------------------|----------------|----------|
| ok          | ```12345678903```   | 200 | номер заказа уже был загружен этим пользователем |
| apply       | ```12345678903```   | 202 | новый номер заказа принят в обработку |
| bad format order number | -       | 400 | неверный формат запроса |
| unauthorize | ```12345678903```   | 401 | пользователь не авторизован |
| order was upload by another user | ```12345678903``` | 409 | номер заказа уже был загружен другим пользователем |
| not correct order number | ```1234567890312``` | 422 | неверный формат номера заказа |

### Получить список заказов ```GET /api/user/orders```
| название    | тело ответа (json) | ответ (статус) | описание              |
|-------------|--------------------|----------------|-----------------------|
| ok          | ```[{"number": "9278923470","status": "NEW","accrual": 500,"uploaded_at": "<2020-12-10T15:15:45+03:00>"},...]``` | 200 | успешная обработка запроса  |
| no content  | -                  | 204            | нет данных для ответа |
| unauthorize | -                  | 401            | пользователь не авторизован |

### Узнать баланс ```GET /api/user/balance```
| название    | тело ответа (json) | ответ (статус) | описание                    |
|-------------|--------------------|----------------|-----------------------------|
| ok          | ```{"current": 500.5, "withdrawn": 42}``` | 200            | успешная обработка запроса |
| unauthorize | -            | 401            | пользователь не авторизован |

### Перевод с баланса ```POST /api/user/balance/withdraw```
| название    | тело запроса (json) | ответ (статус) | описание |
|-------------|---------------------|----------------|----------|
| ok          | ```{"order": "2377225624", "sum":1}``` | 200 | успешная обработка запроса    |
| unauthorize | ```{"order": "2377225624", "sum":1}``` | 401 | пользователь не авторизован   |
| no money    | ```{"order": "2377225624", "sum":1}``` | 402 | на счету недостаточно средств |
| uncorrect order number | ```{"order": "2377225624123", "sum":1}``` | 422 | неверный номер заказа |

### Узнать баланс ```GET /api/user/withdrawals```
| название    | тело ответ (json) | ответ (статус) | описание                    |
|-------------|-------------------|----------------|-----------------------------|
| ok          | ```[{"order": "2377225624","sum": 500,"processed_at": "2020-12-09T16:09:57+03:00"}...]```| 200            | успешная обработка запроса  |
| no content  | -            | 204            | нет ни одного списания      |
| unauthorize | -            | 401            | пользователь не авторизован |

#
# go-musthave-diploma-tpl

Шаблон репозитория для индивидуального дипломного проекта курса «Go-разработчик»

# Начало работы

1. Склонируйте репозиторий в любую подходящую директорию на вашем компьютере.
2. В корне репозитория выполните команду `go mod init <name>` (где `<name>` — адрес вашего репозитория на GitHub без
   префикса `https://`) для создания модуля

# Обновление шаблона

Чтобы иметь возможность получать обновления автотестов и других частей шаблона, выполните команду:

```
git remote add -m master template https://github.com/yandex-praktikum/go-musthave-diploma-tpl.git
```

Для обновления кода автотестов выполните команду:

```
git fetch template && git checkout template/master .github
```

Затем добавьте полученные изменения в свой репозиторий.
